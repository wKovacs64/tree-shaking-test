# Tree-shaking Test

## Project Layout

The `library` directory contains a library (`my-library`) that should support
tree-shaking when being consumed by a tree-shaking bundler like webpack. It is
made up of 2 exports, `a` and `b`. `a` has no dependencies, but `b` depends on
an external module (`jssha`).

The `consumer` directory contains a project generated by `create-react-app`
which imports only the `a` function from the `my-library`.

## Setup

##### In the `library` directory:

```sh
yarn
yarn build
yarn link
```

##### In the `consumer` directory:

```sh
yarn
yarn link my-library
yarn analyze # opens webpack-bundle-analyzer results in the browser
```

##### Expected Results

The external `jssha` module should not be included in the bundle as the client
did not import module `b` from `my-library`, which is the only module in
`my-library` that depends on `jssha`.

##### Actual Results

The external `jssha` module is included in the client bundle.

## A "Fix"

##### In the `library` directory:

Modify `rollup.config.js` and comment out the single-file config and uncomment
the second config that uses `experimentalCodeSplitting`, then rebuild the
library.

```sh
yarn build
```

##### In the `consumer` directory:

```sh
yarn analyze
```

##### New Results

The external `jssha` module is not included in the bundle.

## Cleanup

##### In the `library` directory:

```sh
yarn unlink
```
